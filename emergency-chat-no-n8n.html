<!-- EMERGENCY CHAT WIDGET - NO N8N DEPENDENCY -->
<!-- Add this to your HTML pages while n8n is being fixed -->

<script>
(function() {
    'use strict';
    
    // Emergency chat - works without n8n
    function createEmergencyChat() {
        // Remove any existing chats
        const existing = document.querySelector('#emergency-atlanta-chat, #atlanta-emergency-launcher');
        if (existing) existing.remove();
        
        // Create launcher
        const launcher = document.createElement('button');
        launcher.id = 'atlanta-emergency-launcher';
        launcher.innerHTML = `
            <div style="position: relative;">
                üí¨
                <span style="position: absolute; top: -3px; right: -3px; width: 10px; height: 10px; background: #ff4444; border: 2px solid white; border-radius: 50%; animation: pulse 2s infinite;"></span>
            </div>
        `;
        launcher.style.cssText = `
            position: fixed !important;
            bottom: 20px !important;
            right: 20px !important;
            width: 60px !important;
            height: 60px !important;
            border-radius: 50% !important;
            background: linear-gradient(135deg, #2e7d32, #4caf50) !important;
            color: white !important;
            border: none !important;
            cursor: pointer !important;
            box-shadow: 0 6px 20px rgba(46,125,50,0.4) !important;
            font-size: 24px !important;
            display: flex !important;
            align-items: center !important;
            justify-content: center !important;
            z-index: 2147483647 !important;
            transition: transform 0.3s ease !important;
        `;
        launcher.title = 'Chat with Atlanta Gutter Guard Pros - Always Available!';
        
        // Create chat window
        const chatWindow = document.createElement('div');
        chatWindow.id = 'emergency-atlanta-chat';
        chatWindow.style.cssText = `
            position: fixed !important;
            bottom: 90px !important;
            right: 20px !important;
            width: 350px !important;
            height: 500px !important;
            background: white !important;
            border-radius: 12px !important;
            box-shadow: 0 8px 32px rgba(0,0,0,0.2) !important;
            display: none !important;
            flex-direction: column !important;
            overflow: hidden !important;
            z-index: 2147483647 !important;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif !important;
        `;
        
        chatWindow.innerHTML = `
            <div style="background: linear-gradient(135deg, #2e7d32, #4caf50); color: white; padding: 20px; display: flex; justify-content: space-between; align-items: center;">
                <div>
                    <h3 style="margin: 0; font-size: 18px; font-weight: bold;">üè† Atlanta Gutter Guard Pros</h3>
                    <p style="margin: 4px 0 0 0; font-size: 13px; opacity: 0.9;">üìû Call (470) 851-6780 for Immediate Help</p>
                </div>
                <button onclick="closeEmergencyChat()" style="background: rgba(255,255,255,0.2); border: none; color: white; font-size: 20px; cursor: pointer; width: 30px; height: 30px; border-radius: 50%;">√ó</button>
            </div>
            <div id="emergency-messages" style="flex: 1; padding: 20px; overflow-y: auto; background: #f9f9f9;">
                <div style="background: white; padding: 15px; border-radius: 10px; border-left: 4px solid #4caf50; margin-bottom: 15px;">
                    <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px;">
                        <span style="font-size: 16px;">üè†</span>
                        <strong style="color: #2e7d32; font-size: 14px;">Atlanta Gutter Assistant</strong>
                        <span style="background: #fff3cd; color: #856404; padding: 2px 6px; border-radius: 10px; font-size: 10px;">BACKUP MODE</span>
                    </div>
                    <p style="margin: 0; color: #555; line-height: 1.4;">Hi! I'm here to help with gutter guards and quotes. Our AI system is temporarily unavailable, but I can still assist you! What's your name?</p>
                </div>
            </div>
            <div style="padding: 15px; border-top: 1px solid #eee; background: white;">
                <div style="display: flex; gap: 10px;">
                    <input type="text" id="emergency-input" placeholder="Type your message..." style="flex: 1; padding: 12px; border: 2px solid #ddd; border-radius: 20px; outline: none;" onkeypress="if(event.key==='Enter') sendEmergencyMessage()">
                    <button onclick="sendEmergencyMessage()" style="background: #2e7d32; color: white; border: none; padding: 12px 20px; border-radius: 20px; cursor: pointer;">Send</button>
                </div>
            </div>
        `;
        
        // Add pulse animation
        const style = document.createElement('style');
        style.textContent = `
            @keyframes pulse {
                0% { transform: scale(1); }
                50% { transform: scale(1.1); }
                100% { transform: scale(1); }
            }
        `;
        document.head.appendChild(style);
        
        // Event handlers
        launcher.onclick = function() {
            chatWindow.style.display = 'flex';
        };
        
        // Global functions
        window.closeEmergencyChat = function() {
            chatWindow.style.display = 'none';
        };
        
        window.sendEmergencyMessage = function() {
            const input = document.getElementById('emergency-input');
            const message = input.value.trim();
            if (!message) return;
            
            addEmergencyMessage(message, true);
            input.value = '';
            
            // Generate intelligent response
            setTimeout(() => {
                const response = getEmergencyResponse(message);
                addEmergencyMessage(response);
            }, 1000);
        };
        
        let conversationStep = 0;
        let userName = '';
        let userEmail = '';
        
        function addEmergencyMessage(content, isUser = false) {
            const messagesDiv = document.getElementById('emergency-messages');
            const messageDiv = document.createElement('div');
            messageDiv.style.marginBottom = '15px';
            
            if (isUser) {
                messageDiv.style.cssText = `
                    background: linear-gradient(135deg, #2e7d32, #4caf50);
                    color: white;
                    padding: 12px 15px;
                    border-radius: 15px 15px 5px 15px;
                    margin-left: 50px;
                    margin-bottom: 15px;
                `;
                messageDiv.textContent = content;
            } else {
                messageDiv.style.cssText = `
                    background: white;
                    padding: 15px;
                    border-radius: 5px 15px 15px 15px;
                    border-left: 4px solid #4caf50;
                    margin-right: 50px;
                    margin-bottom: 15px;
                `;
                messageDiv.innerHTML = `
                    <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px;">
                        <span>üè†</span>
                        <strong style="color: #2e7d32; font-size: 12px;">Atlanta Gutter Guard Pros</strong>
                    </div>
                    <div style="color: #555;">${content}</div>
                `;
            }
            
            messagesDiv.appendChild(messageDiv);
            messagesDiv.scrollTop = messagesDiv.scrollHeight;
        }
        
        function getEmergencyResponse(message) {
            const msg = message.toLowerCase();
            
            // Step-by-step conversation flow
            if (conversationStep === 0) {
                userName = message.split(' ')[0];
                conversationStep = 1;
                return `Nice to meet you, ${userName}! What's your email address so I can send you a quote?`;
            }
            
            if (conversationStep === 1 && (msg.includes('@') || msg.includes('email'))) {
                userEmail = message;
                conversationStep = 2;
                return `Perfect! What's going on with your gutters, ${userName}? Are you dealing with clogs, overflows, or maintenance issues?`;
            }
            
            if (msg.includes('quote') || msg.includes('price') || msg.includes('cost')) {
                return `I'd be happy to give you a quote! Is your home 1 story or 2 stories? This helps me calculate the right price.`;
            }
            
            if (msg.includes('1') || msg.includes('one') || msg.includes('single')) {
                return `Great! For a single-story home in Atlanta, our gutter guard installation typically runs <strong>$800-$1,200</strong> depending on size. This includes premium micro-mesh guards with lifetime warranty. I'll email details to ${userEmail || 'your email'}. Would you like to schedule a free inspection? Call us at <strong>(470) 851-6780</strong>!`;
            }
            
            if (msg.includes('2') || msg.includes('two') || msg.includes('story')) {
                return `Perfect! For a two-story home, our installation runs <strong>$1,400-$2,000</strong> depending on complexity. This includes our premium system with lifetime warranty. I'll send detailed pricing to ${userEmail || 'your email'}. Ready to schedule? Call <strong>(470) 851-6780</strong>!`;
            }
            
            if (msg.includes('schedule') || msg.includes('appointment')) {
                return `Excellent! Call us at <strong>(470) 851-6780</strong> to schedule your free inspection. We're available Monday-Friday, 8 AM to 6 PM. We'll come out, assess your gutters, and give you an exact quote - no pressure, just expert advice!`;
            }
            
            if (msg.includes('clog') || msg.includes('leaf') || msg.includes('clean')) {
                return `Those problems are exactly what our gutter guards solve! Our micro-mesh technology keeps leaves and debris out while allowing water to flow freely. No more dangerous ladder climbing or expensive cleaning services. Would you like a quote?`;
            }
            
            // Fallback responses
            return `I can help you with gutter guard pricing, scheduling, and answering questions. For immediate assistance, call us at <strong>(470) 851-6780</strong>. What would you like to know about our gutter protection systems?`;
        }
        
        // Add to page
        document.body.appendChild(launcher);
        document.body.appendChild(chatWindow);
    }
    
    // Initialize
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', createEmergencyChat);
    } else {
        createEmergencyChat();
    }
    
})();
</script>